<htmlform>

<script type="text/javascript">

if(jQuery){
		
		$j(document).ready(function(){
    if ( $j.browser.msie ) {
        $j(":checkbox").click(function(){
             $j(this).change();
     });
 }
 $j(".enableDisable").each(function(){
     var group = $j(this);
     function disableFn(){
         group.children("#disabled").fadeTo(250,0.33);
         group.children("#disabled").find(":checkbox").attr("checked",false); //uncheck
         group.children("#disabled").find("input[type$='text']").val("");
         group.children("#disabled").find("input").attr("disabled",true);  //disable
     }
 function enableFn(){
     group.children("#disabled").fadeTo(250,1);
     group.children("#disabled").find("input").attr("disabled",false);
 }
 disableFn();
 $j(this).children("#trigger").find(":checkbox:first").change(function(){
     var checked = $j(this).attr("checked");
     if(checked == true){
          enableFn();
     }else{
         disableFn();
     }
 });
});
 
 
 $j(".checkboxGroup").each(function(){
     var group = $j(this);
     var uncheckAll = function(){
         group.find("input[type$='checkbox']").attr("checked",false);
         group.find("input[type$='checkbox']").change();
     }
     var uncheckRadioAndAll = function(){
     group.find("#checkboxAll,.checkboxRadio").find("input[type$='checkbox']").attr("checked",false);
     group.find("#checkboxAll,.checkboxRadio").find("input[type$='checkbox']").change();
 }
 
 
 
 group.find("#checkboxAll").find("input").click(
    
    function(){
         var flip;
         var checked = $j(this).siblings(":checkbox:first").attr("checked");
         if($j(this).attr("name") == $j(this).parents("#checkboxAll:first").find(":checkbox:first").attr("name")){
             checked = $j(this).attr("checked");
             flip = checked;
         }else{
             flip = !checked;
         }
         if($j(this).attr("type") == "text") if(flip == false) flip = !filp; // this is so the user doesn't go to check the checkbox, then uncheck it when they hit the input.
         uncheckAll();
         $j(this).parents("#checkboxAll:first").find(":checkbox").attr("checked",flip);
         $j(this).parents("#checkboxAll:first").find(":checkbox").change();
     }
 );
 
 
 
 group.find(".checkboxRadio").find("input[type$='checkbox']").click(function(){

	 uncheckAll();
     $j(this).siblings("input[type$='checkbox']").attr("checked",false);
     $j(this).attr("checked",true);
     $j(this).change();
	 
	 
 });
 
 group.find("#checkboxCheckbox").click(
     function(){
         uncheckRadioAndAll();
     }
 );
 });
 });

      $j(function(){
          $j('#1-removeEntry').remove();
          $j('#20-addEntry').remove();
          $j('#1-toggleContainer').show();
 
        });
 
 
      $j(function(){
      $j('button.addEntry').live("click", function(){
      var correctedAddButtonId = parseFloat(this.id) + 1;
      var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
      $j(contentAddId).toggle(true);
      $j('#' + this.id).toggle(false); $j('#' + parseFloat(this.id) + '-removeEntry').toggle(false);
      return false;});
    });
 
     $j(function(){
      $j('button.removeEntry').live("click", function(){
      var correctedRemoveButtonId = parseFloat(this.id) - 1;
      var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
      $j(contentAddId).toggle(false);
      $j( ':input:not(:button)', contentAddId).val([]);
      $j('#' + correctedRemoveButtonId + '-addEntry').toggle(true); $j('#' + correctedRemoveButtonId + '-removeEntry').toggle(true);
 
      return false;});
			
		
		});
		
		$j(function(){
			
			$j("#dm_date").hide();
			$j("#htn_date").hide();
			$j("#mi_date").hide();
			$j("#cva_date").hide();
			
			//Configration for DM
			$j("#w12_1").click(function() {
				if($j("#w12_1").attr("checked")) {
					
					$j("#dm_date").hide();
					setValue("dm.value","");
				}
			});
			$j("#w12_0").click(function() {
				if($j("#w12_0").attr("checked")) {
				
					$j("#dm_date").show();
				}
			});
			
			//Configration for HTN
			$j("#w16_1").click(function() {
				if($j("#w16_1").attr("checked")) {
					
					$j("#htn_date").hide();
					setValue("htn.value","");
				}
			});
			$j("#w16_0").click(function() {
				if($j("#w16_0").attr("checked")) {
				
					$j("#htn_date").show();
				}
			});
			
			//Configration for CVA
			$j("#w24_1").click(function() {
				if($j("#w24_1").attr("checked")) {
					
					$j("#cva_date").hide();
					setValue("cva.value","");
				}
			});
			$j("#w24_0").click(function() {
				if($j("#w24_0").attr("checked")) {
				
					$j("#cva_date").show();
				}
			});
			
			//Configration for MI
			$j("#w20_1").click(function() {
				if($j("#w20_1").attr("checked")) {
					
					$j("#mi_date").hide();
					setValue("mi.value","");
				}
			});
			$j("#w20_0").click(function() {
				if($j("#w20_0").attr("checked")) {
				
					$j("#mi_date").show();
				}
			});
			
			//If yes is selected in past medical history, date must be provided
			beforeSubmit.push(function() {
			
				//CVA
				if($j("#w24_0").attr("checked")) {
					var cva = getValue("cva.value");
					if(cva.length == 0) {
						alert("Date of Myocardial infarction must be entered");
						return false;
					}
				}
				
				//MI
				if($j("#w20_0").attr("checked")) {
					var mi = getValue("mi.value");
					if(mi.length==0) {
						alert("Date of Myocardial infarction must be entered");
						return false;
					}
				}
				
				//HTN
				if($j("#w16_0").attr("checked")) {
					var htn = getValue("htn.value");
					if(htn.length==0) {
						alert("Date of Hypertension must be entered");
						return false;
					}
				}
				
				//DM
				if($j("#w12_0").attr("checked")) {
					var dm = getValue("dm.value");
					if(dm.length==0) {
						alert("Date of Diabetes Mellitus must be entered");
						return false;
					}
				}
				
				return true;
			});
			
			
			$j(function(){
				$j('.type').hide();
			});
		});
		
}//end outmost if


</script>
	<!--<macros>
                paperFormId = (Fill this in)
		headerColor =#009d8e
		fontOnHeaderColor = white
	</macros>-->

	<style>
		.section {
			border: 1px solid #009d8e;
			padding: 2px;
			text-align: left;
			margin-bottom: 1em;
		}
		.sectionHeader {
			background-color: #009d8e;
			color: white;
			display: block;
			padding: 2px;
			font-weight: bold;
		}
		table.baseline-aligned td {
			vertical-align: baseline;
		}
		.d_date {
			color: blue;
		}
		.required {
		
			color:red;
		}
		.lookup {
			padding-left: 2cm;
		}
	</style>

	<span style="float:right">Paper Form ID: $paperFormId</span>
	<h2>PATIENT MEDICAL HISTORY</h2>

	<section headerLabel="1. Encounter Details">
		<table class="baseline-aligned">
			<tr>
				<td>Date:</td>
				<td><encounterDate default="today"/></td>
				<td><pre>			</pre></td>
				<td>Location:</td>
				<td><encounterLocation default="Unknown Location" /></td>
				<td><pre>			</pre></td>
				<td>Provider:</td>
				<td><encounterProvider default="currentUser" role="Provider" /></td>
				<td><pre>			</pre></td>
				<td class="type">Type:</td>
				<td class="type"><encounterType default="PATHIST" /></td>
				
			</tr>
		</table>
	</section>

	<section headerLabel="2. Patient Information">
		<table class="baseline-aligned">
			<tr>
				<td>Name:</td>
				<td><lookup class="value" expression="patient.personName"/></td>
				<td><pre>		</pre></td>
				<td>Manual ID:</td>
				<td><lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Old Identification Number') ) $patId #end "/></td>
				<td><pre>		</pre></td>
				<td>Auto ID:</td>
				<td><lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('OpenMRS Identification Number') ) $patId #end"/></td>
				<td><pre>		</pre></td>
				<td>Gender:</td>
				<td><lookup class="value" expression="patient.gender"/></td>
			</tr>
			
		</table>
	</section>

        <section headerLabel="3. Medical Information">

		<br />
		<fieldset><legend>Family History</legend>
		<table class="baseline-aligned">
			<tr>
				<td>Family History of Diabetes Mellitus:</td>
				<td><obs conceptId="140228" style="radio" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" /></td>
				<ifMode mode="ENTER">
					<td class="lookup">
						<lookup expression="fn.latestObs(140228).valueCoded.name" class="value"/>
					</td>
				</ifMode>
			</tr>
		</table>
		</fieldset>

		<br />
		<br />
		
		<fieldset><legend>Past Medical History</legend>
		<table class="baseline-aligned">
		<tr>
		<td>
			<table>
            <tr>
				<obsgroup groupingConceptId="161609">
					<td>
						Diabetes Mellitus
					</td>
					<td>
						<obs conceptId="119481"  answerConceptIds="1065,1066" answerLabels="Yes,No" style="radio" />
					</td>
					<td id="dm_date">
						<obs conceptId="159948" id="dm" />
					</td>
					<ifMode mode="ENTER">
					<td class="value">
						<lookup complexExpression="#foreach($enc in $fn.allEncounters(null))
								
								#if($form == $enc.form.formId)
								
									#set($latestEnc = $fn.latestEncounter($enc.encounterType))
									
									#foreach($obs in $latestEnc.obs)
										
									
												#if($obs.concept.conceptId == 119481)
													 
													 #foreach($obs2 in $obs.getRelatedObservations())
														
														#if($obs2.concept.conceptId == 119481)
															 - $obs2.valueCoded.name - 
														#end
														
														#if($obs2.concept.conceptId == 159948)
															- $obs2.valueDatetime - 
														#end
														
													 #end
													 
													 &lt;br &gt;
													 &lt;br &gt;
												#end
												
									#end

								
									#break
								#end
							#end" class="value" />
					</td>
					</ifMode>
				</obsgroup>
			</tr>
			<tr>
				<obsgroup groupingConceptId="161611">
					<td>
						Hypertension
					</td>
					<td>
						<obs conceptId="161572" answerConceptIds="1065,1066" answerLabels="Yes,No" style="radio" />
					</td>
					<td id="htn_date">
						<obs conceptId="159948" id="htn" />
					</td>
					<ifMode mode="ENTER">
					<td class="value">
						<lookup complexExpression="#foreach($enc in $fn.allEncounters(null))
								
								#if($form == $enc.form.formId)
								
									#set($latestEnc = $fn.latestEncounter($enc.encounterType))
									
									#foreach($obs in $latestEnc.obs)
										
									
												#if($obs.concept.conceptId == 161572)
													 
													 #foreach($obs2 in $obs.getRelatedObservations())
														
														#if($obs2.concept.conceptId == 161572)
															 - $obs2.valueCoded.name - 
														#end
														
														#if($obs2.concept.conceptId == 159948)
															- $obs2.valueDatetime - 
														#end
														
													 #end
													 
													 &lt;br &gt;
													 &lt;br &gt;
												#end
												
									#end

								
									#break
								#end
							#end" class="value" />
					</td>
					</ifMode>
				</obsgroup>
			</tr>
			<tr>
				<obsgroup groupingConceptId="161610">
					<td>
						Myocardial Infarction
					</td>
					<td>
						<obs conceptId="161608" answerConceptIds="1065,1066" answerLabels="Yes,No" style="radio" />
					</td>
					<td id="mi_date">
						<obs conceptId="159948" id="mi" />
					</td>
					<ifMode mode="ENTER">
					<td class="value">
						<lookup complexExpression="#foreach($enc in $fn.allEncounters(null))
								
								#if($form == $enc.form.formId)
								
									#set($latestEnc = $fn.latestEncounter($enc.encounterType))
									
									#foreach($obs in $latestEnc.obs)
										
									
												#if($obs.concept.conceptId == 161608)
													 
													 #foreach($obs2 in $obs.getRelatedObservations())
														
														#if($obs2.concept.conceptId == 161608)
															 - $obs2.valueCoded.name - 
														#end
														
														#if($obs2.concept.conceptId == 159948)
															- $obs2.valueDatetime - 
														#end
														
													 #end
													 
													 &lt;br &gt;
													 &lt;br &gt;
												#end
												
									#end

								
									#break
								#end
							#end" class="value" />
					</td>
					</ifMode>
				</obsgroup>
			</tr>
			<tr>
				<obsgroup groupingConceptId="161612">
					<td>
						CerebroVascular Accident
					</td>
					<td>
						<obs conceptId="161564" answerConceptIds="1065,1066" answerLabels="Yes,No" style="radio" />
					</td>
					<td id="cva_date">
						<obs conceptId="159948" id="cva" />
					</td>
					<ifMode mode="ENTER">
					<td class="value">
						<lookup complexExpression="#foreach($enc in $fn.allEncounters(null))
								
								#if($form == $enc.form.formId)
								
									#set($latestEnc = $fn.latestEncounter($enc.encounterType))
									
									#foreach($obs in $latestEnc.obs)
										
									
												#if($obs.concept.conceptId == 161564)
													 
													 #foreach($obs2 in $obs.getRelatedObservations())
														
														#if($obs2.concept.conceptId == 161564)
															 - $obs2.valueCoded.name - 
														#end
														
														#if($obs2.concept.conceptId == 159948)
															- $obs2.valueDatetime - 
														#end
														
													 #end
													 
													 &lt;br &gt;
													 &lt;br &gt;
												#end
												
									#end

								
									#break
								#end
							#end" class="value" />
					</td>
					</ifMode>
				</obsgroup>
			</tr>
			
			</table>
		</td>
		</tr>
		</table>
		</fieldset>
		
		<br />
		<br />
		<fieldset><legend>Past Surgical History</legend>
		<table class="baseline-aligned">
			<tr>
				<td>Amputation:</td>
				<td><obs conceptId="161568" answerConceptIds="161567,161566,1066" answerLabels="Yes - DM Related,Yes DM not Related,No" style="radio" /></td>
				<ifMode mode="ENTER">
					<td class="lookup">
						<lookup expression="fn.latestObs(161568).valueCoded.name" class="value"/>
					</td>
				</ifMode>
			</tr>
		</table>
		</fieldset>
			<tr>
				<td colspan="2"><br /></td>
			</tr>
		
		<br />
		<fieldset><legend>Social History</legend>
		<table class="baseline-aligned">
			<tr>
				<td>Smoker:</td>
				<td><obs conceptId="152722" answerConceptIds="1065,1066,1067" answerLabels="Yes,No,Unknown" style="radio" /></td>
				<ifMode mode="ENTER">
					<td class="lookup">
						<lookup expression="fn.latestObs(152722).valueCoded.name" class="value"/>
					</td>
				</ifMode>
			</tr>
		</table>
		</fieldset>

	</section>


	<submit/>


</htmlform>